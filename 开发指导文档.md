# Phone-Agent-Web è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°å¼€å‘æŒ‡å¯¼æ–‡æ¡£

> åŸºäº AutoGLM-GUI æ¶æ„åˆ†æï¼Œæ„å»ºä¸“ä¸šçš„ iOS/Android è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°

## ğŸ“‹ ç›®å½•

- [ä¸€ã€é¡¹ç›®æ¦‚è¿°](#ä¸€é¡¹ç›®æ¦‚è¿°)
- [äºŒã€æŠ€æœ¯æ¶æ„](#äºŒæŠ€æœ¯æ¶æ„)
- [ä¸‰ã€åˆ†é˜¶æ®µå¼€å‘è®¡åˆ’](#ä¸‰åˆ†é˜¶æ®µå¼€å‘è®¡åˆ’)
- [å››ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡](#å››æ ¸å¿ƒæ¨¡å—è®¾è®¡)
- [äº”ã€API æ¥å£è®¾è®¡](#äº”api-æ¥å£è®¾è®¡)
- [å…­ã€å‰ç«¯ç»„ä»¶è®¾è®¡](#å…­å‰ç«¯ç»„ä»¶è®¾è®¡)
- [ä¸ƒã€æ•°æ®åº“è®¾è®¡](#ä¸ƒæ•°æ®åº“è®¾è®¡)
- [å…«ã€å¼€å‘è§„èŒƒ](#å…«å¼€å‘è§„èŒƒ)
- [ä¹ã€æµ‹è¯•ä¸éƒ¨ç½²](#ä¹æµ‹è¯•ä¸éƒ¨ç½²)

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½

**ä» AI åŠ©æ‰‹åˆ°è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°**

| ç»´åº¦ | å½“å‰ Phone-Agent-Web | ç›®æ ‡å¹³å° |
|------|---------------------|---------|
| **å®šä½** | AI æ‰‹æœºåŠ©æ‰‹ Demo | ä¸“ä¸šè‡ªåŠ¨åŒ–æµ‹è¯•å¹³å° |
| **ç”¨æˆ·** | ä¸ªäººç”¨æˆ· | æµ‹è¯•å·¥ç¨‹å¸ˆã€QA å›¢é˜Ÿ |
| **æ ¸å¿ƒåŠŸèƒ½** | LLM é©±åŠ¨çš„ä»»åŠ¡æ‰§è¡Œ | æµ‹è¯•ç”¨ä¾‹ç®¡ç† + è‡ªåŠ¨åŒ–æ‰§è¡Œ |
| **åº”ç”¨åœºæ™¯** | æ—¥å¸¸ä»»åŠ¡è‡ªåŠ¨åŒ– | å›å½’æµ‹è¯•ã€UI æµ‹è¯•ã€å…¼å®¹æ€§æµ‹è¯• |

### 1.2 æ ¸å¿ƒç›®æ ‡

1. âœ… **è®¾å¤‡ç®¡ç†** - æ”¯æŒå¤šè®¾å¤‡å¹¶å‘æµ‹è¯•
2. âœ… **å®æ—¶ç›‘æ§** - æˆªå›¾å®æ—¶åŒæ­¥ã€è®¾å¤‡çŠ¶æ€ç›‘æ§
3. âœ… **ç”¨ä¾‹ç®¡ç†** - å¯è§†åŒ–åˆ›å»ºã€ç¼–è¾‘ã€ç»„ç»‡æµ‹è¯•ç”¨ä¾‹
4. âœ… **è‡ªåŠ¨æ‰§è¡Œ** - æ‰¹é‡æ‰§è¡Œã€å¹¶å‘æ‰§è¡Œã€å®šæ—¶æ‰§è¡Œ
5. âœ… **ç»“æœåˆ†æ** - è¯¦ç»†æŠ¥å‘Šã€è¶‹åŠ¿åˆ†æã€å¤±è´¥å®šä½

### 1.3 æŠ€æœ¯ä¼˜åŠ¿

- âœ… åŸºäºæˆç†Ÿçš„ AutoGLM æ¡†æ¶
- âœ… æ”¯æŒ iOS å’Œ Android åŒå¹³å°
- âœ… å®æ—¶é€šä¿¡ï¼Œæ“ä½œå¯è§
- âœ… è½»é‡çº§æ¶æ„ï¼Œæ˜“äºéƒ¨ç½²

---

## äºŒã€æŠ€æœ¯æ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å‰ç«¯å±‚ (Vue 3 + JavaScript)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è®¾å¤‡ç®¡ç†é¢æ¿ â”‚  â”‚ ç”¨ä¾‹ç¼–è¾‘å™¨   â”‚  â”‚ æ‰§è¡Œç›‘æ§é¢æ¿ â”‚      â”‚
â”‚  â”‚ - è®¾å¤‡åˆ—è¡¨   â”‚  â”‚ - æ­¥éª¤ç¼–è¾‘   â”‚  â”‚ - å®æ—¶æ—¥å¿—   â”‚      â”‚
â”‚  â”‚ - è¿æ¥çŠ¶æ€   â”‚  â”‚ - å‚æ•°é…ç½®   â”‚  â”‚ - æˆªå›¾é¢„è§ˆ   â”‚      â”‚
â”‚  â”‚ - å®æ—¶æˆªå›¾   â”‚  â”‚ - æ–­è¨€è®¾ç½®   â”‚  â”‚ - è¿›åº¦ç›‘æ§   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                    WebSocket + REST API                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åç«¯å±‚ (FastAPI + WebSocket)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    API è·¯ç”±å±‚                         â”‚   â”‚
â”‚  â”‚  /api/devices  /api/testcases  /api/execute  /api/resultsâ”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚DeviceManagerâ”‚    â”‚TestExecutorâ”‚    â”‚ResultManagerâ”‚      â”‚
â”‚  â”‚- è®¾å¤‡å‘ç°   â”‚    â”‚- ç”¨ä¾‹è§£æ  â”‚    â”‚- ç»“æœæ”¶é›†   â”‚      â”‚
â”‚  â”‚- çŠ¶æ€ç›‘æ§   â”‚    â”‚- æ­¥éª¤æ‰§è¡Œ  â”‚    â”‚- æŠ¥å‘Šç”Ÿæˆ   â”‚      â”‚
â”‚  â”‚- æˆªå›¾æ¨é€   â”‚    â”‚- æ–­è¨€éªŒè¯  â”‚    â”‚- æ•°æ®åˆ†æ   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              æ•°æ®æŒä¹…åŒ–å±‚ (SQLAlchemy)             â”‚     â”‚
â”‚  â”‚  Device  TestCase  TestStep  TestResult  Screenshotâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  è®¾å¤‡å±‚ (IOSPhoneAgent)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ iOS Device   â”‚              â”‚Android Deviceâ”‚             â”‚
â”‚  â”‚ (WDA)        â”‚              â”‚ (ADB)        â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆé€‰å‹

#### åç«¯æŠ€æœ¯æ ˆ

```python
æ ¸å¿ƒæ¡†æ¶ï¼š
- FastAPI 0.109+ - ç°ä»£ Web æ¡†æ¶
- WebSocket (FastAPI å†…ç½®) - å®æ—¶é€šä¿¡
- SQLAlchemy 2.0+ - ORM æ•°æ®åº“æ“ä½œ
- Pydantic - æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
- Uvicorn - ASGI æœåŠ¡å™¨
- Celery - å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼‰
- Redis - ç¼“å­˜ + æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼‰

API æ–‡æ¡£ï¼š
- Swagger UI - è‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼ API æ–‡æ¡£
- ReDoc - è‡ªåŠ¨ç”Ÿæˆç¾è§‚çš„ API æ–‡æ¡£
- OpenAPI 3.0 - API è§„èŒƒ

æ•°æ®åº“ï¼š
- SQLite - å¼€å‘ç¯å¢ƒ
- PostgreSQL - ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰

è®¾å¤‡æ§åˆ¶ï¼š
- IOSPhoneAgent (AutoGLM) - iOS è®¾å¤‡æ§åˆ¶
- AndroidPhoneAgent (AutoGLM) - Android è®¾å¤‡æ§åˆ¶
- WebDriverAgent - iOS åº•å±‚åè®®
- ADB - Android åº•å±‚åè®®
```

#### å‰ç«¯æŠ€æœ¯æ ˆ

```javascript
æ ¸å¿ƒæ¡†æ¶ï¼š
- Vue 3.4+ (çº¯ JavaScriptï¼Œä¸ä½¿ç”¨ TypeScript)
- TailwindCSS 4.x - åŸå­åŒ– CSS æ¡†æ¶
- shadcn-vue - UI ç»„ä»¶åº“ï¼ˆåŸºäº Radix Vueï¼‰
- Socket.IO Client - å®æ—¶é€šä¿¡
- TanStack Query Vue - æ•°æ®ç®¡ç†
- Vue-ECharts - æ•°æ®å¯è§†åŒ–
- Pinia - çŠ¶æ€ç®¡ç†
- Vue Router 4 - è·¯ç”±ç®¡ç†
- Lucide Vue Next - å›¾æ ‡åº“

æ„å»ºå·¥å…·ï¼š
- Vite - æ„å»ºå·¥å…·ï¼ˆå¼€å‘æ—¶å®æ—¶çƒ­æ›´æ–°ï¼‰
- ESLint + Prettier - ä»£ç è§„èŒƒ

è¯´æ˜ï¼š
- ä¸ä½¿ç”¨ TypeScriptï¼Œé™ä½å­¦ä¹ æˆæœ¬
- Vite å¼€å‘æœåŠ¡å™¨æä¾›å®æ—¶é¢„è§ˆï¼Œä¿å­˜å³åˆ·æ–°
- é¦–æ¬¡æ­å»ºåªéœ€ 5 åˆ†é’Ÿï¼Œä¹‹åå¼€å‘ä½“éªŒä¼˜äºåŸç”Ÿ HTML
```

### 2.3 ç°æœ‰ä»£ç æƒ…å†µ

**å½“å‰æ¶æ„ï¼ˆv0.1ï¼‰ï¼š**
```
Phone-Agent-Web/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app.py              # Flask åº”ç”¨
â”‚   â”œâ”€â”€ models.py           # SQLAlchemy æ¨¡å‹
â”‚   â””â”€â”€ config.py           # é…ç½®æ–‡ä»¶
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â””â”€â”€ index.html      # çº¯ HTML + åŸç”Ÿ JS
â”‚   â””â”€â”€ static/             # CSS/å›¾ç‰‡
â””â”€â”€ database/
    â””â”€â”€ phone_agent.db      # SQLite æ•°æ®åº“
```

**ç‰¹ç‚¹ï¼š**
- âœ… åç«¯ï¼šFlask + SQLAlchemy
- âœ… å‰ç«¯ï¼šçº¯ HTML + åŸç”Ÿ JavaScript
- âœ… å•é¡µé¢åº”ç”¨ï¼ŒåŠŸèƒ½ç®€å•
- âœ… æ— éœ€æ„å»ºå·¥å…·ï¼ŒåŒå‡» HTML å³å¯æŸ¥çœ‹

**è¿ç§»å»ºè®®ï¼š**
1. **çŸ­æœŸ**ï¼šä¿æŒç°æœ‰æ¶æ„ï¼Œç»§ç»­ä½¿ç”¨ Flask + HTML
2. **ä¸­æœŸ**ï¼šæ–°å»º Vue é¡¹ç›®ï¼ˆä¸ç°æœ‰ä»£ç å¹¶å­˜ï¼‰ï¼Œé€é¡µè¿ç§»
3. **é•¿æœŸ**ï¼šå®Œå…¨åˆ‡æ¢åˆ° Vue + FastAPI

---

### 2.4 ä¾èµ–å…³ç³»è¯´æ˜

```
Phone-Agent-Web ä¾èµ–ï¼š
âœ… WebDriverAgent - iOS è®¾å¤‡æ§åˆ¶åº•å±‚
âœ… AutoGLM (phone_agent) - è®¾å¤‡æŠ½è±¡å±‚å’Œ Agent å®ç°
âŒ AutoGLM-GUI - ä¸ä¾èµ–ï¼ˆä»…å€Ÿé‰´æ¶æ„è®¾è®¡ï¼‰

ä¾èµ–é“¾è·¯ï¼š
Phone-Agent-Web (FastAPI)
    â””â”€â”€ phone_agent (AutoGLM)
            â”œâ”€â”€ IOSPhoneAgent
            â”‚   â””â”€â”€ WebDriverAgent
            â””â”€â”€ AndroidPhoneAgent
                â””â”€â”€ ADB

è¯´æ˜ï¼š
- ç›´æ¥ä½¿ç”¨ AutoGLM çš„ phone_agent åº“
- ä¸ä¾èµ– AutoGLM-GUI çš„ä»£ç 
- å€Ÿé‰´ AutoGLM-GUI çš„æ¶æ„è®¾è®¡æ€æƒ³
- ä½¿ç”¨ FastAPI è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£
```

### 2.5 API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ

**FastAPI è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ï¼š**

```
è®¿é—®åœ°å€ï¼š
- Swagger UI: http://localhost:5001/docs
- ReDoc: http://localhost:5001/redoc
- OpenAPI JSON: http://localhost:5001/openapi.json

ç‰¹æ€§ï¼š
âœ… è‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼ API æ–‡æ¡£
âœ… æ”¯æŒåœ¨çº¿æµ‹è¯• API
âœ… è‡ªåŠ¨ç±»å‹éªŒè¯
âœ… è¯·æ±‚/å“åº”ç¤ºä¾‹
âœ… æ”¯æŒå¯¼å‡º OpenAPI è§„èŒƒ
```

---

## ä¸‰ã€åˆ†é˜¶æ®µå¼€å‘è®¡åˆ’

### é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½å±‚ï¼ˆ2-3 å‘¨ï¼‰

**ç›®æ ‡ï¼šå»ºç«‹ç¨³å®šçš„è®¾å¤‡ç®¡ç†å’Œå®æ—¶é€šä¿¡åŸºç¡€**

#### ä»»åŠ¡æ¸…å•

- [ ] **1.1 è®¾å¤‡ç®¡ç†æ¨¡å—**
  - [ ] è®¾å¤‡å‘ç°ï¼ˆUSB/WiFiï¼‰
  - [ ] è®¾å¤‡çŠ¶æ€ç›‘æ§ï¼ˆåå°çº¿ç¨‹ï¼‰
  - [ ] è®¾å¤‡è¿æ¥/æ–­å¼€
  - [ ] å¤šè®¾å¤‡å¹¶å‘æ”¯æŒ
  
- [ ] **1.2 å®æ—¶æˆªå›¾ç³»ç»Ÿ**
  - [ ] WebSocket æˆªå›¾æ¨é€
  - [ ] æˆªå›¾ç¼“å­˜æœºåˆ¶
  - [ ] å‰ç«¯å®æ—¶æ˜¾ç¤º
  
- [ ] **1.3 åŸºç¡€æ“ä½œæ¥å£**
  - [ ] ç‚¹å‡» (tap)
  - [ ] æ»‘åŠ¨ (swipe)
  - [ ] è¾“å…¥æ–‡æœ¬ (input)
  - [ ] æŒ‰é”® (press_key)
  - [ ] æˆªå›¾ (screenshot)

#### äº¤ä»˜ç‰©

```
backend/
  â”œâ”€â”€ device_manager.py      # è®¾å¤‡ç®¡ç†å™¨
  â”œâ”€â”€ screenshot_manager.py  # æˆªå›¾ç®¡ç†å™¨
  â””â”€â”€ api/
      â””â”€â”€ devices.py         # è®¾å¤‡ API

frontend/
  â””â”€â”€ src/
      â”œâ”€â”€ components/
      â”‚   â”œâ”€â”€ DevicePanel.vue      # è®¾å¤‡é¢æ¿
      â”‚   â””â”€â”€ ScreenshotViewer.vue # æˆªå›¾æŸ¥çœ‹å™¨
      â””â”€â”€ api/
          â””â”€â”€ devices.ts     # è®¾å¤‡ API å®¢æˆ·ç«¯
```

---

### é˜¶æ®µ 2ï¼šæµ‹è¯•ç”¨ä¾‹ç®¡ç†ï¼ˆ3-4 å‘¨ï¼‰

**ç›®æ ‡ï¼šæ„å»ºæµ‹è¯•ç”¨ä¾‹çš„åˆ›å»ºã€ç¼–è¾‘ã€ç»„ç»‡ä½“ç³»**

#### ä»»åŠ¡æ¸…å•

- [ ] **2.1 æ•°æ®æ¨¡å‹è®¾è®¡**
  - [ ] TestCase æ¨¡å‹
  - [ ] TestStep æ¨¡å‹
  - [ ] Assertion æ¨¡å‹
  - [ ] æ•°æ®åº“è¿ç§»
  
- [ ] **2.2 ç”¨ä¾‹ CRUD API**
  - [ ] åˆ›å»ºç”¨ä¾‹
  - [ ] ç¼–è¾‘ç”¨ä¾‹
  - [ ] åˆ é™¤ç”¨ä¾‹
  - [ ] æŸ¥è¯¢ç”¨ä¾‹
  - [ ] ç”¨ä¾‹åˆ†ç»„/æ ‡ç­¾
  
- [ ] **2.3 å¯è§†åŒ–ç¼–è¾‘å™¨**
  - [ ] æ­¥éª¤åˆ—è¡¨ç»„ä»¶
  - [ ] æ­¥éª¤ç¼–è¾‘å™¨
  - [ ] åŠ¨ä½œé€‰æ‹©å™¨
  - [ ] å‚æ•°é…ç½®é¢æ¿
  - [ ] æ–­è¨€æ„å»ºå™¨

#### æ•°æ®æ¨¡å‹

```python
# TestCase - æµ‹è¯•ç”¨ä¾‹
{
    "id": "uuid",
    "name": "ç™»å½•æµ‹è¯•",
    "description": "æµ‹è¯•ç”¨æˆ·ç™»å½•åŠŸèƒ½",
    "platform": "ios",  # ios/android
    "tags": ["ç™»å½•", "å†’çƒŸæµ‹è¯•"],
    "steps": [
        {
            "type": "action",  # action/wait/assertion
            "action": "tap",
            "params": {"x": 100, "y": 200},
            "description": "ç‚¹å‡»ç™»å½•æŒ‰é’®",
            "timeout": 5,
            "screenshot_before": true,
            "screenshot_after": true
        },
        {
            "type": "assertion",
            "assertion_type": "text_contains",
            "target": "æ¬¢è¿",
            "expected": true
        }
    ],
    "created_at": "2026-01-05T10:00:00",
    "updated_at": "2026-01-05T10:00:00"
}
```

#### äº¤ä»˜ç‰©

```
backend/
  â”œâ”€â”€ models.py              # æ•°æ®æ¨¡å‹
  â”œâ”€â”€ test_case_manager.py   # ç”¨ä¾‹ç®¡ç†å™¨
  â””â”€â”€ api/
      â””â”€â”€ testcases.py       # ç”¨ä¾‹ API

frontend/
  â””â”€â”€ src/
      â”œâ”€â”€ components/
      â”‚   â”œâ”€â”€ TestCaseList.vue      # ç”¨ä¾‹åˆ—è¡¨
      â”‚   â”œâ”€â”€ TestCaseEditor.vue    # ç”¨ä¾‹ç¼–è¾‘å™¨
      â”‚   â”œâ”€â”€ StepEditor.vue        # æ­¥éª¤ç¼–è¾‘å™¨
      â”‚   â””â”€â”€ AssertionBuilder.vue  # æ–­è¨€æ„å»ºå™¨
      â””â”€â”€ pages/
          â””â”€â”€ TestCases.vue   # ç”¨ä¾‹ç®¡ç†é¡µé¢
```

---

### é˜¶æ®µ 3ï¼šæ‰§è¡Œå¼•æ“ï¼ˆ3-4 å‘¨ï¼‰

**ç›®æ ‡ï¼šå®ç°æµ‹è¯•ç”¨ä¾‹çš„è‡ªåŠ¨åŒ–æ‰§è¡Œå’Œç»“æœæ”¶é›†**

#### ä»»åŠ¡æ¸…å•

- [ ] **3.1 æ‰§è¡Œå¼•æ“æ ¸å¿ƒ**
  - [ ] ç”¨ä¾‹è§£æå™¨
  - [ ] æ­¥éª¤æ‰§è¡Œå™¨
  - [ ] æ–­è¨€éªŒè¯å™¨
  - [ ] é”™è¯¯å¤„ç†æœºåˆ¶
  - [ ] æ‰§è¡Œæ—¥å¿—è®°å½•
  
- [ ] **3.2 ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿ**
  - [ ] ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
  - [ ] è®¾å¤‡èµ„æºè°ƒåº¦
  - [ ] å¹¶å‘æ‰§è¡Œæ§åˆ¶
  - [ ] ä»»åŠ¡ä¼˜å…ˆçº§
  
- [ ] **3.3 å®æ—¶ç›‘æ§**
  - [ ] æ‰§è¡Œè¿›åº¦æ¨é€
  - [ ] å®æ—¶æ—¥å¿—æ¨é€
  - [ ] æˆªå›¾è‡ªåŠ¨ä¿å­˜
  - [ ] æ‰§è¡ŒçŠ¶æ€æ›´æ–°

#### æ‰§è¡Œæµç¨‹

```python
æ‰§è¡Œæµç¨‹ï¼š
1. æ¥æ”¶æ‰§è¡Œè¯·æ±‚ (test_case_id, device_id)
2. éªŒè¯è®¾å¤‡å¯ç”¨æ€§
3. åŠ è½½æµ‹è¯•ç”¨ä¾‹
4. åˆå§‹åŒ–è®¾å¤‡è¿æ¥
5. é€æ­¥æ‰§è¡Œï¼š
   a. æ‰§è¡Œå‰æˆªå›¾ï¼ˆå¦‚æœé…ç½®ï¼‰
   b. æ‰§è¡ŒåŠ¨ä½œ
   c. æ‰§è¡Œåæˆªå›¾ï¼ˆå¦‚æœé…ç½®ï¼‰
   d. éªŒè¯æ–­è¨€
   e. è®°å½•ç»“æœ
   f. æ¨é€è¿›åº¦
6. ç”Ÿæˆæµ‹è¯•ç»“æœ
7. æ¸…ç†èµ„æº
8. è¿”å›ç»“æœ
```

#### äº¤ä»˜ç‰©

```
backend/
  â”œâ”€â”€ test_executor.py       # æµ‹è¯•æ‰§è¡Œå™¨
  â”œâ”€â”€ task_queue.py          # ä»»åŠ¡é˜Ÿåˆ—
  â”œâ”€â”€ assertion_validator.py # æ–­è¨€éªŒè¯å™¨
  â””â”€â”€ api/
      â””â”€â”€ execute.py         # æ‰§è¡Œ API

frontend/
  â””â”€â”€ src/
      â”œâ”€â”€ components/
      â”‚   â”œâ”€â”€ ExecutionMonitor.vue  # æ‰§è¡Œç›‘æ§
      â”‚   â”œâ”€â”€ LogViewer.vue         # æ—¥å¿—æŸ¥çœ‹å™¨
      â”‚   â””â”€â”€ ProgressBar.vue       # è¿›åº¦æ¡
      â””â”€â”€ pages/
          â””â”€â”€ Execution.vue   # æ‰§è¡Œé¡µé¢
```

---

### é˜¶æ®µ 4ï¼šç»“æœåˆ†æä¸æŠ¥å‘Šï¼ˆ2-3 å‘¨ï¼‰

**ç›®æ ‡ï¼šæä¾›è¯¦ç»†çš„æµ‹è¯•ç»“æœåˆ†æå’Œå¯è§†åŒ–æŠ¥å‘Š**

#### ä»»åŠ¡æ¸…å•

- [ ] **4.1 ç»“æœæ”¶é›†**
  - [ ] æ‰§è¡Œç»“æœå­˜å‚¨
  - [ ] æˆªå›¾å½’æ¡£
  - [ ] æ—¥å¿—å½’æ¡£
  - [ ] æ€§èƒ½æ•°æ®æ”¶é›†
  
- [ ] **4.2 æŠ¥å‘Šç”Ÿæˆ**
  - [ ] æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿
  - [ ] HTML æŠ¥å‘Šç”Ÿæˆ
  - [ ] PDF æŠ¥å‘Šå¯¼å‡º
  - [ ] æŠ¥å‘Šåˆ†äº«é“¾æ¥
  
- [ ] **4.3 æ•°æ®åˆ†æ**
  - [ ] é€šè¿‡ç‡ç»Ÿè®¡
  - [ ] å¤±è´¥åŸå› åˆ†æ
  - [ ] æ‰§è¡Œæ—¶é•¿åˆ†æ
  - [ ] å†å²è¶‹åŠ¿å¯¹æ¯”
  
- [ ] **4.4 å¯è§†åŒ–å±•ç¤º**
  - [ ] æ‰§è¡Œè¶‹åŠ¿å›¾
  - [ ] é€šè¿‡ç‡é¥¼å›¾
  - [ ] è®¾å¤‡æ€§èƒ½å¯¹æ¯”
  - [ ] å¤±è´¥æ­¥éª¤çƒ­åŠ›å›¾

#### æŠ¥å‘Šæ•°æ®æ¨¡å‹

```python
# TestResult - æµ‹è¯•ç»“æœ
{
    "id": "uuid",
    "test_case_id": "uuid",
    "test_case_name": "ç™»å½•æµ‹è¯•",
    "device_id": "00008101-001D059E0481401E",
    "device_name": "iPhone12",
    "status": "PASS",  # PASS/FAIL/ERROR
    "start_time": "2026-01-05T10:00:00",
    "end_time": "2026-01-05T10:01:30",
    "duration": 90,  # ç§’
    "steps_total": 10,
    "steps_passed": 10,
    "steps_failed": 0,
    "steps_results": [
        {
            "step_index": 0,
            "status": "PASS",
            "duration": 2.5,
            "screenshot_before": "base64...",
            "screenshot_after": "base64...",
            "log": "æ‰§è¡ŒæˆåŠŸ",
            "error": null
        }
    ],
    "error_message": null,
    "created_at": "2026-01-05T10:01:30"
}
```

#### äº¤ä»˜ç‰©

```
backend/
  â”œâ”€â”€ result_manager.py      # ç»“æœç®¡ç†å™¨
  â”œâ”€â”€ report_generator.py    # æŠ¥å‘Šç”Ÿæˆå™¨
  â””â”€â”€ api/
      â””â”€â”€ results.py         # ç»“æœ API

frontend/
  â””â”€â”€ src/
      â”œâ”€â”€ components/
      â”‚   â”œâ”€â”€ ResultList.vue        # ç»“æœåˆ—è¡¨
      â”‚   â”œâ”€â”€ ResultDetail.vue      # ç»“æœè¯¦æƒ…
      â”‚   â”œâ”€â”€ TrendChart.vue        # è¶‹åŠ¿å›¾
      â”‚   â””â”€â”€ StatisticsPanel.vue   # ç»Ÿè®¡é¢æ¿
      â””â”€â”€ pages/
          â””â”€â”€ Results.vue     # ç»“æœé¡µé¢
```

---

### é˜¶æ®µ 5ï¼šé«˜çº§ç‰¹æ€§ï¼ˆæŒ‰éœ€å¼€å‘ï¼‰

#### 5.1 AI è¾…åŠ©æµ‹è¯•

- [ ] æ™ºèƒ½å…ƒç´ å®šä½ï¼ˆåŸºäºæˆªå›¾è¯†åˆ«ï¼‰
- [ ] è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼ˆå½•åˆ¶æ¨¡å¼ï¼‰
- [ ] å¼‚å¸¸è‡ªåŠ¨æ¢å¤
- [ ] æµ‹è¯•ç”¨ä¾‹ä¼˜åŒ–å»ºè®®

#### 5.2 æŒç»­é›†æˆ

- [ ] CI/CD é›†æˆï¼ˆJenkins/GitLab CIï¼‰
- [ ] å®šæ—¶ä»»åŠ¡
- [ ] Webhook è§¦å‘
- [ ] é€šçŸ¥æœºåˆ¶ï¼ˆé‚®ä»¶ã€é’‰é’‰ã€ä¼å¾®ï¼‰

#### 5.3 æ€§èƒ½æµ‹è¯•

- [ ] å¯åŠ¨æ—¶é—´æµ‹è¯•
- [ ] å†…å­˜å ç”¨ç›‘æ§
- [ ] CPU ä½¿ç”¨ç‡ç›‘æ§
- [ ] ç½‘ç»œæµé‡ç›‘æ§

---

## å››ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 4.1 DeviceManagerï¼ˆè®¾å¤‡ç®¡ç†å™¨ï¼‰

#### åŠŸèƒ½èŒè´£

```python
class DeviceManager:
    """è®¾å¤‡ç®¡ç†å™¨ - å•ä¾‹æ¨¡å¼"""
    
    åŠŸèƒ½ï¼š
    1. è®¾å¤‡å‘ç°ä¸è¿æ¥
    2. è®¾å¤‡çŠ¶æ€ç›‘æ§ï¼ˆåå°çº¿ç¨‹ï¼‰
    3. è®¾å¤‡èµ„æºè°ƒåº¦
    4. æˆªå›¾å®æ—¶æ¨é€
    5. è®¾å¤‡æ“ä½œæ¥å£
    
    æ ¸å¿ƒæ–¹æ³•ï¼š
    - get_devices() -> List[Device]
    - connect_device(device_id) -> bool
    - disconnect_device(device_id) -> bool
    - get_screenshot(device_id) -> Screenshot
    - execute_action(device_id, action) -> Result
    - start_monitoring() -> None
    - stop_monitoring() -> None
```

#### å®ç°è¦ç‚¹

```python
# åå°ç›‘æ§çº¿ç¨‹
def _monitor_loop(self):
    """æ¯ 2 ç§’æ‰«æè®¾å¤‡çŠ¶æ€"""
    while self._running:
        devices = self._scan_devices()
        self._update_device_states(devices)
        socketio.emit('device_status', devices)
        time.sleep(2)

# æˆªå›¾æ¨é€
def _screenshot_loop(self, device_id):
    """å®æ—¶æ¨é€è®¾å¤‡æˆªå›¾"""
    while device_id in self._active_streams:
        screenshot = self._get_screenshot(device_id)
        socketio.emit('screenshot', {
            'device_id': device_id,
            'image': screenshot.base64_data,
            'timestamp': time.time()
        })
        time.sleep(0.5)  # 2 FPS
```

---

### 4.2 TestExecutorï¼ˆæµ‹è¯•æ‰§è¡Œå™¨ï¼‰

#### åŠŸèƒ½èŒè´£

```python
class TestExecutor:
    """æµ‹è¯•æ‰§è¡Œå™¨"""
    
    åŠŸèƒ½ï¼š
    1. è§£ææµ‹è¯•ç”¨ä¾‹
    2. æ‰§è¡Œæµ‹è¯•æ­¥éª¤
    3. éªŒè¯æ–­è¨€
    4. æ”¶é›†ç»“æœ
    5. æ¨é€è¿›åº¦
    
    æ ¸å¿ƒæ–¹æ³•ï¼š
    - execute(test_case_id, device_id) -> TestResult
    - execute_step(step) -> StepResult
    - validate_assertion(assertion) -> bool
    - capture_screenshot() -> Screenshot
    - emit_progress(progress) -> None
```

#### æ‰§è¡Œæµç¨‹

```python
def execute(self, test_case_id, device_id):
    """æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹"""
    # 1. åˆå§‹åŒ–
    test_case = self._load_test_case(test_case_id)
    device = self.device_manager.get_device(device_id)
    result = TestResult(test_case_id=test_case_id)
    
    # 2. æ‰§è¡Œæ­¥éª¤
    for i, step in enumerate(test_case.steps):
        # æ¨é€è¿›åº¦
        self._emit_progress(i, len(test_case.steps))
        
        # æ‰§è¡Œå‰æˆªå›¾
        if step.screenshot_before:
            screenshot = device.get_screenshot()
            result.add_screenshot('before', screenshot)
        
        # æ‰§è¡Œæ­¥éª¤
        try:
            if step.type == 'action':
                self._execute_action(device, step)
            elif step.type == 'assertion':
                self._validate_assertion(device, step)
            elif step.type == 'wait':
                time.sleep(step.params['duration'])
            
            result.add_step_result(i, 'PASS')
        except Exception as e:
            result.add_step_result(i, 'FAIL', str(e))
            if not step.continue_on_error:
                break
        
        # æ‰§è¡Œåæˆªå›¾
        if step.screenshot_after:
            screenshot = device.get_screenshot()
            result.add_screenshot('after', screenshot)
    
    # 3. ä¿å­˜ç»“æœ
    result.save()
    return result
```

---

### 4.3 ResultManagerï¼ˆç»“æœç®¡ç†å™¨ï¼‰

#### åŠŸèƒ½èŒè´£

```python
class ResultManager:
    """ç»“æœç®¡ç†å™¨"""
    
    åŠŸèƒ½ï¼š
    1. ç»“æœå­˜å‚¨ä¸æŸ¥è¯¢
    2. æŠ¥å‘Šç”Ÿæˆ
    3. æ•°æ®ç»Ÿè®¡åˆ†æ
    4. å†å²è¶‹åŠ¿åˆ†æ
    
    æ ¸å¿ƒæ–¹æ³•ï¼š
    - save_result(result) -> None
    - get_result(result_id) -> TestResult
    - query_results(filters) -> List[TestResult]
    - generate_report(result_id) -> Report
    - get_statistics(date_range) -> Statistics
```

---

## äº”ã€API æ¥å£è®¾è®¡

### 5.1 FastAPI æ¥å£è§„èŒƒ

**æ‰€æœ‰æ¥å£ä½¿ç”¨ Pydantic æ¨¡å‹è¿›è¡Œæ•°æ®éªŒè¯å’Œåºåˆ—åŒ–**

```python
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from typing import List, Optional

app = FastAPI(
    title="Phone-Agent-Web API",
    description="è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å° API æ–‡æ¡£",
    version="1.0.0",
    docs_url="/docs",
    redoc_url="/redoc"
)
```

### 5.2 è®¾å¤‡ç®¡ç† API

```python
# Pydantic æ¨¡å‹
class Device(BaseModel):
    device_id: str
    name: str
    platform: str  # "ios" | "android"
    status: str    # "online" | "offline"
    model: Optional[str] = None
    connection_type: str  # "usb" | "wifi"

class DeviceListResponse(BaseModel):
    devices: List[Device]

# è·å–è®¾å¤‡åˆ—è¡¨
@app.get("/api/devices", response_model=DeviceListResponse)
async def list_devices():
    """
    è·å–æ‰€æœ‰å·²è¿æ¥çš„è®¾å¤‡åˆ—è¡¨
    
    Returns:
        DeviceListResponse: è®¾å¤‡åˆ—è¡¨
    """
    devices = device_manager.get_devices()
    return DeviceListResponse(devices=devices)

# è¿æ¥è®¾å¤‡
class ConnectRequest(BaseModel):
    device_id: str

class ConnectResponse(BaseModel):
    success: bool
    message: str

@app.post("/api/devices/connect", response_model=ConnectResponse)
async def connect_device(request: ConnectRequest):
    """
    è¿æ¥æŒ‡å®šè®¾å¤‡
    
    Args:
        request: åŒ…å« device_id çš„è¯·æ±‚
    
    Returns:
        ConnectResponse: è¿æ¥ç»“æœ
    """
    success = device_manager.connect(request.device_id)
    return ConnectResponse(
        success=success,
        message="è¿æ¥æˆåŠŸ" if success else "è¿æ¥å¤±è´¥"
    )

# è·å–æˆªå›¾
class ScreenshotRequest(BaseModel):
    device_id: str

class ScreenshotResponse(BaseModel):
    success: bool
    image: str
    width: int
    height: int

@app.post("/api/devices/screenshot", response_model=ScreenshotResponse)
async def take_screenshot(request: ScreenshotRequest):
    """
    è·å–è®¾å¤‡æˆªå›¾
    
    Args:
        request: åŒ…å« device_id çš„è¯·æ±‚
    
    Returns:
        ScreenshotResponse: æˆªå›¾æ•°æ®ï¼ˆbase64 ç¼–ç ï¼‰
    """
    screenshot = device_manager.get_screenshot(request.device_id)
    return ScreenshotResponse(
        success=True,
        image=screenshot.base64_data,
        width=screenshot.width,
        height=screenshot.height
    )

# æ‰§è¡Œæ“ä½œ
class ActionRequest(BaseModel):
    device_id: str
    action: str  # "tap" | "swipe" | "input" | "press_key"
    params: dict

class ActionResponse(BaseModel):
    success: bool
    message: Optional[str] = None

@app.post("/api/devices/action", response_model=ActionResponse)
async def execute_action(request: ActionRequest):
    """
    æ‰§è¡Œè®¾å¤‡æ“ä½œ
    
    Args:
        request: æ“ä½œè¯·æ±‚ï¼ˆåŠ¨ä½œç±»å‹å’Œå‚æ•°ï¼‰
    
    Returns:
        ActionResponse: æ‰§è¡Œç»“æœ
    
    Examples:
        ç‚¹å‡»: {"action": "tap", "params": {"x": 100, "y": 200}}
        æ»‘åŠ¨: {"action": "swipe", "params": {"x1": 100, "y1": 200, "x2": 300, "y2": 400}}
    """
    device_manager.execute_action(
        request.device_id,
        request.action,
        request.params
    )
    return ActionResponse(success=True)
```

### 5.3 æµ‹è¯•ç”¨ä¾‹ API

```python
# Pydantic æ¨¡å‹
class TestStep(BaseModel):
    type: str  # "action" | "wait" | "assertion"
    action: Optional[str] = None
    params: Optional[dict] = None
    description: Optional[str] = None
    timeout: int = 5
    screenshot_before: bool = False
    screenshot_after: bool = False

class TestCase(BaseModel):
    id: Optional[str] = None
    name: str
    description: Optional[str] = None
    platform: str  # "ios" | "android"
    tags: List[str] = []
    steps: List[TestStep]

class TestCaseCreateResponse(BaseModel):
    id: str
    success: bool

# åˆ›å»ºç”¨ä¾‹
@app.post("/api/testcases", response_model=TestCaseCreateResponse)
async def create_test_case(test_case: TestCase):
    """
    åˆ›å»ºæ–°çš„æµ‹è¯•ç”¨ä¾‹
    
    Args:
        test_case: æµ‹è¯•ç”¨ä¾‹æ•°æ®
    
    Returns:
        TestCaseCreateResponse: åˆ›å»ºç»“æœï¼ˆåŒ…å«ç”¨ä¾‹ IDï¼‰
    """
    case_id = test_case_manager.create(test_case)
    return TestCaseCreateResponse(id=case_id, success=True)

# è·å–ç”¨ä¾‹åˆ—è¡¨
class TestCaseSummary(BaseModel):
    id: str
    name: str
    platform: str
    steps_count: int
    tags: List[str]
    created_at: str

class TestCaseListResponse(BaseModel):
    testcases: List[TestCaseSummary]
    total: int

@app.get("/api/testcases", response_model=TestCaseListResponse)
async def list_test_cases(
    platform: Optional[str] = None,
    tag: Optional[str] = None,
    skip: int = 0,
    limit: int = 100
):
    """
    è·å–æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨
    
    Args:
        platform: å¹³å°ç­›é€‰ï¼ˆios/androidï¼‰
        tag: æ ‡ç­¾ç­›é€‰
        skip: è·³è¿‡æ•°é‡ï¼ˆåˆ†é¡µï¼‰
        limit: è¿”å›æ•°é‡ï¼ˆåˆ†é¡µï¼‰
    
    Returns:
        TestCaseListResponse: ç”¨ä¾‹åˆ—è¡¨
    """
    cases = test_case_manager.list(
        platform=platform,
        tag=tag,
        skip=skip,
        limit=limit
    )
    return TestCaseListResponse(
        testcases=cases,
        total=len(cases)
    )

# è·å–ç”¨ä¾‹è¯¦æƒ…
@app.get("/api/testcases/{case_id}", response_model=TestCase)
async def get_test_case(case_id: str):
    """
    è·å–æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…
    
    Args:
        case_id: ç”¨ä¾‹ ID
    
    Returns:
        TestCase: ç”¨ä¾‹è¯¦æƒ…
    
    Raises:
        HTTPException: ç”¨ä¾‹ä¸å­˜åœ¨æ—¶è¿”å› 404
    """
    case = test_case_manager.get(case_id)
    if not case:
        raise HTTPException(status_code=404, detail="Test case not found")
    return case

# æ›´æ–°ç”¨ä¾‹
class UpdateResponse(BaseModel):
    success: bool

@app.put("/api/testcases/{case_id}", response_model=UpdateResponse)
async def update_test_case(case_id: str, test_case: TestCase):
    """
    æ›´æ–°æµ‹è¯•ç”¨ä¾‹
    
    Args:
        case_id: ç”¨ä¾‹ ID
        test_case: æ›´æ–°åçš„ç”¨ä¾‹æ•°æ®
    
    Returns:
        UpdateResponse: æ›´æ–°ç»“æœ
    """
    test_case_manager.update(case_id, test_case)
    return UpdateResponse(success=True)

# åˆ é™¤ç”¨ä¾‹
@app.delete("/api/testcases/{case_id}", response_model=UpdateResponse)
async def delete_test_case(case_id: str):
    """
    åˆ é™¤æµ‹è¯•ç”¨ä¾‹
    
    Args:
        case_id: ç”¨ä¾‹ ID
    
    Returns:
        UpdateResponse: åˆ é™¤ç»“æœ
    """
    test_case_manager.delete(case_id)
    return UpdateResponse(success=True)
```

### 5.4 æ‰§è¡Œ API

```python
# æ‰§è¡Œæµ‹è¯•
POST /api/execute
Request: {
    "test_case_id": "uuid",
    "device_id": "xxx"
}
Response: {
    "execution_id": "uuid",
    "status": "running"
}

# è·å–æ‰§è¡ŒçŠ¶æ€
GET /api/execute/{execution_id}/status
Response: {
    "execution_id": "uuid",
    "status": "running",
    "progress": 50,
    "current_step": 5,
    "total_steps": 10
}

# åœæ­¢æ‰§è¡Œ
POST /api/execute/{execution_id}/stop
Response: {"success": true}
```

### 5.5 ç»“æœ API

```python
# è·å–ç»“æœåˆ—è¡¨
GET /api/results
Query: ?test_case_id=xxx&status=FAIL&date_from=2026-01-01
Response: {
    "results": [
        {
            "id": "uuid",
            "test_case_name": "ç™»å½•æµ‹è¯•",
            "device_name": "iPhone12",
            "status": "PASS",
            "duration": 90,
            "created_at": "2026-01-05T10:00:00"
        }
    ]
}

# è·å–ç»“æœè¯¦æƒ…
GET /api/results/{id}
Response: {
    "id": "uuid",
    "test_case_name": "ç™»å½•æµ‹è¯•",
    "steps_results": [...],
    "screenshots": [...]
}

# ç”ŸæˆæŠ¥å‘Š
POST /api/results/{id}/report
Request: {"format": "html"}
Response: {
    "report_url": "/reports/xxx.html"
}

# è·å–ç»Ÿè®¡æ•°æ®
GET /api/results/statistics
Query: ?date_from=2026-01-01&date_to=2026-01-31
Response: {
    "total_executions": 100,
    "pass_rate": 85.5,
    "avg_duration": 120,
    "trend": [...]
}
```

### 5.6 WebSocket äº‹ä»¶

**FastAPI WebSocket å®ç°ï¼š**

```python
from fastapi import WebSocket, WebSocketDisconnect
from typing import Dict, Set

class ConnectionManager:
    def __init__(self):
        self.active_connections: Dict[str, Set[WebSocket]] = {}
    
    async def connect(self, websocket: WebSocket, client_id: str):
        await websocket.accept()
        if client_id not in self.active_connections:
            self.active_connections[client_id] = set()
        self.active_connections[client_id].add(websocket)
    
    async def disconnect(self, websocket: WebSocket, client_id: str):
        self.active_connections[client_id].remove(websocket)
    
    async def broadcast(self, message: dict, client_id: str = None):
        if client_id:
            for connection in self.active_connections.get(client_id, []):
                await connection.send_json(message)
        else:
            for connections in self.active_connections.values():
                for connection in connections:
                    await connection.send_json(message)

manager = ConnectionManager()

# WebSocket ç«¯ç‚¹
@app.websocket("/ws/{client_id}")
async def websocket_endpoint(websocket: WebSocket, client_id: str):
    await manager.connect(websocket, client_id)
    try:
        while True:
            data = await websocket.receive_text()
            # å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯
            await manager.broadcast(
                {"type": "message", "data": data},
                client_id
            )
    except WebSocketDisconnect:
        await manager.disconnect(websocket, client_id)

# è®¾å¤‡çŠ¶æ€æ›´æ–°
async def broadcast_device_status(device_id: str, status: str):
    await manager.broadcast({
        "event": "device_status",
        "data": {
            "device_id": device_id,
            "status": status
        }
    })

# å®æ—¶æˆªå›¾
Event: 'screenshot'
Data: {
    "device_id": "xxx",
    "image": "base64...",
    "timestamp": 1234567890
}

# æ‰§è¡Œè¿›åº¦
Event: 'execution_progress'
Data: {
    "execution_id": "uuid",
    "progress": 50,
    "current_step": 5,
    "message": "æ­£åœ¨æ‰§è¡Œç¬¬ 5 æ­¥"
}

# æ‰§è¡Œæ—¥å¿—
Event: 'execution_log'
Data: {
    "execution_id": "uuid",
    "level": "info",
    "message": "ç‚¹å‡»ç™»å½•æŒ‰é’®æˆåŠŸ",
    "timestamp": 1234567890
}
```

---

## å…­ã€å‰ç«¯ç»„ä»¶è®¾è®¡

### 6.1 é¡µé¢ç»“æ„

```
App.vue
â”œâ”€â”€ Layout.vue
â”‚   â”œâ”€â”€ Header.vue
â”‚   â”œâ”€â”€ Sidebar.vue
â”‚   â””â”€â”€ Content
â”‚       â”œâ”€â”€ Dashboard.vue (é¦–é¡µ)
â”‚       â”œâ”€â”€ Devices.vue (è®¾å¤‡ç®¡ç†)
â”‚       â”œâ”€â”€ TestCases.vue (ç”¨ä¾‹ç®¡ç†)
â”‚       â”œâ”€â”€ Execution.vue (æ‰§è¡Œç›‘æ§)
â”‚       â””â”€â”€ Results.vue (ç»“æœåˆ†æ)
```

### 6.2 æ ¸å¿ƒç»„ä»¶

#### DevicePanelï¼ˆè®¾å¤‡é¢æ¿ï¼‰

```vue
<!-- DevicePanel.vue -->
<script setup lang="ts">
interface Props {
  devices: Device[]
}

const props = defineProps<Props>()
const emit = defineEmits<{
  connect: [deviceId: string]
  disconnect: [deviceId: string]
  screenshot: [deviceId: string]
}>()
</script>

åŠŸèƒ½ï¼š
- æ˜¾ç¤ºè®¾å¤‡åˆ—è¡¨
- è®¾å¤‡è¿æ¥/æ–­å¼€
- å®æ—¶çŠ¶æ€æ›´æ–°
- æˆªå›¾é¢„è§ˆ
```

#### TestCaseEditorï¼ˆç”¨ä¾‹ç¼–è¾‘å™¨ï¼‰

```typescript
interface TestCaseEditorProps {
    testCase: TestCase;
    onChange: (testCase: TestCase) => void;
    onSave: () => void;
}

åŠŸèƒ½ï¼š
- æ­¥éª¤åˆ—è¡¨ç¼–è¾‘
- æ‹–æ‹½æ’åº
- å‚æ•°é…ç½®
- æ–­è¨€è®¾ç½®
- å®æ—¶é¢„è§ˆ
```

#### ExecutionMonitorï¼ˆæ‰§è¡Œç›‘æ§ï¼‰

```typescript
interface ExecutionMonitorProps {
    executionId: string;
}

åŠŸèƒ½ï¼š
- å®æ—¶è¿›åº¦æ˜¾ç¤º
- æ—¥å¿—æµå¼è¾“å‡º
- æˆªå›¾å®æ—¶é¢„è§ˆ
- åœæ­¢/æš‚åœæ§åˆ¶
```

#### ResultViewerï¼ˆç»“æœæŸ¥çœ‹å™¨ï¼‰

```typescript
interface ResultViewerProps {
    resultId: string;
}

åŠŸèƒ½ï¼š
- ç»“æœè¯¦æƒ…å±•ç¤º
- æ­¥éª¤çº§è¯¦æƒ…
- æˆªå›¾å¯¹æ¯”
- å¤±è´¥åŸå› åˆ†æ
- æŠ¥å‘Šå¯¼å‡º
```

---

## ä¸ƒã€æ•°æ®åº“è®¾è®¡

### 7.1 è¡¨ç»“æ„

#### devicesï¼ˆè®¾å¤‡è¡¨ï¼‰

```sql
CREATE TABLE devices (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255),
    platform VARCHAR(50),  -- ios/android
    model VARCHAR(255),
    status VARCHAR(50),    -- online/offline
    connection_type VARCHAR(50),  -- usb/wifi
    last_seen TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### test_casesï¼ˆæµ‹è¯•ç”¨ä¾‹è¡¨ï¼‰

```sql
CREATE TABLE test_cases (
    id VARCHAR(36) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    platform VARCHAR(50),
    tags JSON,
    steps JSON,  -- æ­¥éª¤æ•°ç»„
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### test_resultsï¼ˆæµ‹è¯•ç»“æœè¡¨ï¼‰

```sql
CREATE TABLE test_results (
    id VARCHAR(36) PRIMARY KEY,
    test_case_id VARCHAR(36),
    test_case_name VARCHAR(255),
    device_id VARCHAR(255),
    device_name VARCHAR(255),
    status VARCHAR(50),  -- PASS/FAIL/ERROR
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    duration INT,  -- ç§’
    steps_total INT,
    steps_passed INT,
    steps_failed INT,
    steps_results JSON,
    error_message TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (test_case_id) REFERENCES test_cases(id)
);
```

#### screenshotsï¼ˆæˆªå›¾è¡¨ï¼‰

```sql
CREATE TABLE screenshots (
    id VARCHAR(36) PRIMARY KEY,
    result_id VARCHAR(36),
    step_index INT,
    type VARCHAR(50),  -- before/after
    image_path VARCHAR(500),  -- æ–‡ä»¶è·¯å¾„
    width INT,
    height INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (result_id) REFERENCES test_results(id)
);
```

---

## å…«ã€å¼€å‘è§„èŒƒ

### 8.1 ä»£ç è§„èŒƒ

#### Python è§„èŒƒ

```python
# 1. ä½¿ç”¨ Type Hints
def execute_test(test_case_id: str, device_id: str) -> TestResult:
    pass

# 2. ä½¿ç”¨ dataclass
from dataclasses import dataclass

@dataclass
class TestCase:
    id: str
    name: str
    steps: List[TestStep]

# 3. å¼‚å¸¸å¤„ç†
try:
    result = execute_action(action)
except DeviceNotAvailableError as e:
    logger.error(f"è®¾å¤‡ä¸å¯ç”¨: {e}")
    raise
except Exception as e:
    logger.exception("æ‰§è¡Œå¤±è´¥")
    raise

# 4. æ—¥å¿—è®°å½•
from loguru import logger

logger.info("å¼€å§‹æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹: {}", test_case.name)
logger.error("æ‰§è¡Œå¤±è´¥: {}", error_message)
```

#### TypeScript è§„èŒƒ

```typescript
// 1. ä½¿ç”¨æ¥å£å®šä¹‰ç±»å‹
interface Device {
  id: string;
  name: string;
  platform: 'ios' | 'android';
  status: 'online' | 'offline';
}

// 2. ä½¿ç”¨å‡½æ•°ç»„ä»¶
const DevicePanel: React.FC<DevicePanelProps> = ({ devices }) => {
  return <div>{/* ... */}</div>;
};

// 3. ä½¿ç”¨ Hooks
const [devices, setDevices] = useState<Device[]>([]);
useEffect(() => {
  fetchDevices();
}, []);

// 4. é”™è¯¯å¤„ç†
try {
  await executeTest(testCaseId, deviceId);
} catch (error) {
  message.error(`æ‰§è¡Œå¤±è´¥: ${error.message}`);
}
```

### 8.2 Git è§„èŒƒ

```bash
# Commit æ ¼å¼
<type>(<scope>): <subject>

# Type ç±»å‹
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»º/å·¥å…·ç›¸å…³

# ç¤ºä¾‹
feat(device): æ·»åŠ è®¾å¤‡è‡ªåŠ¨é‡è¿åŠŸèƒ½
fix(executor): ä¿®å¤æ­¥éª¤æ‰§è¡Œè¶…æ—¶é—®é¢˜
docs(api): æ›´æ–° API æ–‡æ¡£
```

### 8.3 æµ‹è¯•è§„èŒƒ

```python
# å•å…ƒæµ‹è¯•
def test_device_manager_get_devices():
    manager = DeviceManager()
    devices = manager.get_devices()
    assert isinstance(devices, list)

# é›†æˆæµ‹è¯•
def test_execute_test_case():
    executor = TestExecutor()
    result = executor.execute(test_case_id, device_id)
    assert result.status in ['PASS', 'FAIL', 'ERROR']
```

---

## ä¹ã€æµ‹è¯•ä¸éƒ¨ç½²

### 9.1 å¼€å‘ç¯å¢ƒæ­å»º

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/Phone-Agent-Web.git
cd Phone-Agent-Web

# 2. å®‰è£…åç«¯ä¾èµ–
pip install -r requirements.txt

# 3. åˆå§‹åŒ–æ•°æ®åº“
python scripts/init_db.py

# 4. å¯åŠ¨åç«¯
python run.py

# 5. å®‰è£…å‰ç«¯ä¾èµ–
cd frontend
npm install

# 6. å¯åŠ¨å‰ç«¯
npm run dev
```

### 9.2 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# 1. ä½¿ç”¨ Gunicorn éƒ¨ç½²åç«¯
gunicorn -w 4 -b 0.0.0.0:5001 run:app

# 2. ä½¿ç”¨ Nginx åå‘ä»£ç†
nginx -c /etc/nginx/nginx.conf

# 3. ä½¿ç”¨ PM2 ç®¡ç†è¿›ç¨‹
pm2 start ecosystem.config.js

# 4. ä½¿ç”¨ Docker éƒ¨ç½²
docker-compose up -d
```

### 9.3 æ€§èƒ½ä¼˜åŒ–

```python
# 1. æ•°æ®åº“ç´¢å¼•
CREATE INDEX idx_test_results_test_case_id ON test_results(test_case_id);
CREATE INDEX idx_test_results_created_at ON test_results(created_at);

# 2. ç¼“å­˜ç­–ç•¥
- è®¾å¤‡çŠ¶æ€ç¼“å­˜ï¼ˆ2 ç§’ï¼‰
- æˆªå›¾ç¼“å­˜ï¼ˆ1 ç§’ï¼‰
- æµ‹è¯•ç”¨ä¾‹ç¼“å­˜ï¼ˆ5 åˆ†é’Ÿï¼‰

# 3. å¼‚æ­¥å¤„ç†
- ä½¿ç”¨ Celery å¤„ç†é•¿æ—¶é—´ä»»åŠ¡
- ä½¿ç”¨ Redis ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—

# 4. å‰ç«¯ä¼˜åŒ–
- ä»£ç åˆ†å‰²ï¼ˆReact.lazyï¼‰
- å›¾ç‰‡æ‡’åŠ è½½
- è™šæ‹Ÿæ»šåŠ¨ï¼ˆé•¿åˆ—è¡¨ï¼‰
```

---

## åã€æ€»ç»“

### 10.1 å¼€å‘æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | æ—¶é—´ | äººåŠ› |
|------|------|------|
| é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½ | 2-3 å‘¨ | 1-2 äºº |
| é˜¶æ®µ 2ï¼šç”¨ä¾‹ç®¡ç† | 3-4 å‘¨ | 1-2 äºº |
| é˜¶æ®µ 3ï¼šæ‰§è¡Œå¼•æ“ | 3-4 å‘¨ | 1-2 äºº |
| é˜¶æ®µ 4ï¼šç»“æœåˆ†æ | 2-3 å‘¨ | 1-2 äºº |
| é˜¶æ®µ 5ï¼šé«˜çº§ç‰¹æ€§ | æŒ‰éœ€å¼€å‘ | 1-2 äºº |
| **æ€»è®¡** | **12-16 å‘¨** | **1-2 äºº** |

### 10.2 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| è®¾å¤‡è¿æ¥ä¸ç¨³å®š | é«˜ | æ–­çº¿é‡è¿ + å¿ƒè·³æ£€æµ‹ |
| å¹¶å‘æ‰§è¡Œå†²çª | ä¸­ | è®¾å¤‡æ±  + èµ„æºé” |
| æˆªå›¾æ€§èƒ½ç“¶é¢ˆ | ä¸­ | å‹ç¼© + ç¼“å­˜ + æŒ‰éœ€æ¨é€ |
| LLM è°ƒç”¨æ…¢ | ä½ | å¼‚æ­¥æ‰§è¡Œ + è¶…æ—¶æ§åˆ¶ |

### 10.3 åç»­è§„åˆ’

1. **çŸ­æœŸï¼ˆ3 ä¸ªæœˆï¼‰**
   - å®Œæˆé˜¶æ®µ 1-4 æ ¸å¿ƒåŠŸèƒ½
   - æ”¯æŒ iOS å’Œ Android åŒå¹³å°
   - åŸºç¡€æŠ¥å‘Šå’Œåˆ†æåŠŸèƒ½

2. **ä¸­æœŸï¼ˆ6 ä¸ªæœˆï¼‰**
   - AI è¾…åŠ©æµ‹è¯•åŠŸèƒ½
   - CI/CD é›†æˆ
   - æ€§èƒ½æµ‹è¯•æ¨¡å—

3. **é•¿æœŸï¼ˆ1 å¹´ï¼‰**
   - äº‘ç«¯éƒ¨ç½²ç‰ˆæœ¬
   - å¤šç§Ÿæˆ·æ”¯æŒ
   - æµ‹è¯•ç”¨ä¾‹å¸‚åœº

---

## é™„å½•

### A. å‚è€ƒèµ„æ–™

- [AutoGLM å®˜æ–¹æ–‡æ¡£](https://github.com/THUDM/AutoGLM)
- [WebDriverAgent æ–‡æ¡£](https://github.com/appium/WebDriverAgent)
- [Flask å®˜æ–¹æ–‡æ¡£](https://flask.palletsprojects.com/)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)

### B. å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ AutoGLM-GUIï¼Ÿ**
A: AutoGLM-GUI æ˜¯é€šç”¨çš„ AI åŠ©æ‰‹å¹³å°ï¼Œè€Œæˆ‘ä»¬éœ€è¦ä¸“é—¨çš„è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°ï¼ŒåŠŸèƒ½å®šä½ä¸åŒã€‚

**Q: æ˜¯å¦æ”¯æŒ Androidï¼Ÿ**
A: æ˜¯çš„ï¼Œé€šè¿‡ AutoGLM çš„ AndroidPhoneAgent æ”¯æŒ Android è®¾å¤‡ã€‚

**Q: å¦‚ä½•ä¿è¯æµ‹è¯•ç¨³å®šæ€§ï¼Ÿ**
A: é€šè¿‡æ–­çº¿é‡è¿ã€é”™è¯¯é‡è¯•ã€è¶…æ—¶æ§åˆ¶ç­‰æœºåˆ¶ä¿è¯ç¨³å®šæ€§ã€‚

### C. è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€ï¼šhttps://github.com/your-repo/Phone-Agent-Web
- é—®é¢˜åé¦ˆï¼šhttps://github.com/your-repo/Phone-Agent-Web/issues
- æŠ€æœ¯äº¤æµï¼šyour-email@example.com

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0**  
**æ›´æ–°æ—¥æœŸï¼š2026-01-05**  
**ä½œè€…ï¼šå¼€å‘å›¢é˜Ÿ**
