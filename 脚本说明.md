# Shell 脚本使用说明

## 📋 脚本清单

### ✅ 推荐使用的脚本

| 脚本名称 | 用途 | 说明 |
|---------|------|------|
| **`start-all.sh`** | 一键启动所有服务 | **推荐使用** - 自动启动 iproxy、后端、前端 |
| **`stop-all.sh`** | 一键停止所有服务 | **推荐使用** - 停止所有相关进程 |

### ⚠️ 旧脚本（保留但不推荐）

| 脚本名称 | 用途 | 说明 |
|---------|------|------|
| `start.sh` | 启动后端（旧版） | 仅启动 Flask 后端，不启动 Vue 前端 |
| `stop.sh` | 停止服务（旧版） | 功能较简单，推荐使用 `stop-all.sh` |

---

## 🚀 快速开始

### 一键启动所有服务

```bash
cd /Users/jianqin/Desktop/ModelTrain/Open-GLM/Phone-Agent-Web
./start-all.sh
```

**启动内容**：
1. ✅ iproxy 端口转发 (8100 -> 8100)
2. ✅ Flask 后端 (http://127.0.0.1:5001)
3. ✅ Vue 前端 (http://localhost:5173)

**注意**：WebDriverAgent 需要在 Xcode 中手动启动，或在其他终端运行。

### 一键停止所有服务

```bash
./stop-all.sh
```

**停止内容**：
1. ✅ Vue 前端进程
2. ✅ Flask 后端进程
3. ✅ iproxy 进程

**注意**：不会停止 WebDriverAgent（需要在 Xcode 中手动停止）。

---

## 📝 详细说明

### `start-all.sh` - 一键启动脚本

**功能**：
- 自动检查并启动 iproxy
- 检查 WebDriverAgent 状态
- 启动 Flask 后端
- 启动 Vue 前端开发服务器
- 显示所有服务的访问地址

**使用方法**：
```bash
./start-all.sh
```

**输出示例**：
```
========================================
  Phone-Agent-Web 一键启动
========================================

[1/4] 检查 iproxy 端口转发...
  ✅ iproxy 已启动

[2/4] 检查 WebDriverAgent...
  ✅ WebDriverAgent 已在运行

[3/4] 启动 Flask 后端...
  ✅ Flask 后端已启动 (PID: 12345)

[4/4] 启动 Vue 前端...
  ✅ Vue 前端已启动 (PID: 12346)

========================================
  ✅ 所有服务已启动成功！
========================================

📊 服务状态：
  • iproxy:        运行中 (8100 -> 8100)
  • WebDriverAgent: http://localhost:8100
  • Flask 后端:    http://127.0.0.1:5001
  • Vue 前端:      http://localhost:5173

🌐 访问地址：
  http://localhost:5173
```

**日志文件**：
- 后端日志：`backend.log`
- 前端日志：`frontend.log`

---

### `stop-all.sh` - 一键停止脚本

**功能**：
- 停止 Vue 前端进程（端口 5173）
- 停止 Flask 后端进程（端口 5001）
- 停止 iproxy 进程
- 清理相关的 npm 和 python 进程

**使用方法**：
```bash
./stop-all.sh
```

**输出示例**：
```
========================================
  Phone-Agent-Web 一键停止
========================================

[1/3] 停止 Vue 前端...
  ✅ Vue 前端已停止

[2/3] 停止 Flask 后端...
  ✅ Flask 后端已停止

[3/3] 停止 iproxy...
  ✅ iproxy 已停止

⚠️  注意：
  WebDriverAgent 未停止（如在 Xcode 中运行，请手动停止）

========================================
  ✅ 所有服务已停止！
========================================
```

---

## 🔧 旧脚本说明

### `start.sh` - 旧版启动脚本

**功能**：
- 启动 WebDriverAgent（通过 xcodebuild）
- 启动 iproxy
- 启动 Flask 后端

**缺点**：
- ❌ 不启动 Vue 前端
- ❌ 只能访问旧的 HTML 页面（已删除）
- ❌ 包含代理设置（可能不适用）

**是否保留**：
- 保留，但不推荐使用
- 如果需要单独启动后端，可以使用

**使用方法**：
```bash
./start.sh
```

---

### `stop.sh` - 旧版停止脚本

**功能**：
- 停止 Flask 后端（端口 5001）
- 停止 iproxy

**缺点**：
- ❌ 不停止 Vue 前端
- ❌ 功能较简单

**是否保留**：
- 保留，但推荐使用 `stop-all.sh`

**使用方法**：
```bash
./stop.sh
```

---

## 🎯 推荐工作流程

### 日常开发

1. **启动所有服务**
   ```bash
   ./start-all.sh
   ```

2. **访问前端**
   ```
   http://localhost:5173
   ```

3. **开发完成后停止服务**
   ```bash
   ./stop-all.sh
   ```

### 仅启动后端（用于 API 测试）

```bash
# 启动 iproxy
iproxy 8100 8100 &

# 启动后端
python3 run.py
```

### 仅启动前端（后端已运行）

```bash
cd frontend-vue
npm run dev
```

---

## ⚠️ 常见问题

### Q1: `start-all.sh` 提示 WebDriverAgent 未运行

**解决方案**：
1. 在 Xcode 中打开 WebDriverAgent 项目
2. 选择设备并运行 WebDriverAgentRunner
3. 或在终端运行：
   ```bash
   cd ~/Desktop/ModelTrain/Open-GLM/WebDriverAgent
   xcodebuild -project WebDriverAgent.xcodeproj \
     -scheme WebDriverAgentRunner \
     -destination "id=$(idevice_id -l | head -1)" \
     test
   ```

### Q2: 端口被占用

**解决方案**：
```bash
# 先停止所有服务
./stop-all.sh

# 再重新启动
./start-all.sh
```

### Q3: 前端启动失败

**解决方案**：
```bash
cd frontend-vue
rm -rf node_modules
npm install
cd ..
./start-all.sh
```

---

## 📊 脚本对比

| 功能 | start-all.sh | start.sh | 手动启动 |
|------|-------------|----------|---------|
| 启动 iproxy | ✅ | ✅ | 需要 |
| 启动 WDA | 检查 | ✅ | 需要 |
| 启动后端 | ✅ | ✅ | 需要 |
| 启动前端 | ✅ | ❌ | 需要 |
| 自动检查 | ✅ | ⚠️ | ❌ |
| 日志输出 | ✅ | ⚠️ | ❌ |
| 推荐使用 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐ |

---

## 🗑️ 已删除的文件

以下文件已被删除（因为现在使用 Vue 前端）：

- ❌ `frontend/` - 旧的 HTML 前端目录
- ❌ `test_agent.py` - 测试脚本
- ❌ `test_logs.html` - 测试页面
- ❌ `backend.log` - 旧日志文件

---

**更新日期**：2026-01-05  
**版本**：v2.0
